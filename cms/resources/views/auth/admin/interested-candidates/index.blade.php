@extends('auth.layouts.app')\n\n@section('title', 'Interested Candidates')\n\n@section('content')\n<div class=\"container-fluid\">\n    <div class=\"row\">\n        <div class=\"col-12\">\n            <div class=\"card\">\n                <div class=\"card-header d-flex justify-content-between align-items-center\">\n                    <h4 class=\"mb-0\">Interested Candidates ({{ $candidates->total() }})</h4>\n                    \n                    <!-- Search Form -->\n                    <form method=\"GET\" class=\"d-flex\">\n                        <input type=\"text\" name=\"search\" class=\"form-control me-2\" \n                               placeholder=\"Search by name, number, role...\" \n                               value=\"{{ request('search') }}\" style=\"width: 300px;\">\n                        <button type=\"submit\" class=\"btn btn-primary\">Search</button>\n                        @if(request('search'))\n                            <a href=\"{{ route('admin.interested.candidates.index') }}\" class=\"btn btn-secondary ms-2\">Clear</a>\n                        @endif\n                    </form>\n                </div>\n                \n                <div class=\"card-body\">\n                    @if($candidates->count() > 0)\n                        <div class=\"table-responsive\">\n                            <table class=\"table table-striped\">\n                                <thead>\n                                    <tr>\n                                        <th>ID</th>\n                                        <th>Name</th>\n                                        <th>Number</th>\n                                        <th>Role</th>\n                                        <th>Status</th>\n                                        <th>Interested Date</th>\n                                        <th>Notes</th>\n                                        <th>Actions</th>\n                                    </tr>\n                                </thead>\n                                <tbody>\n                                    @foreach($candidates as $candidate)\n                                    <tr>\n                                        <td>{{ $candidate->id }}</td>\n                                        <td>{{ $candidate->name }}</td>\n                                        <td>{{ $candidate->number }}</td>\n                                        <td>{{ $candidate->role }}</td>\n                                        <td>\n                                            <select class=\"form-select form-select-sm status-select\" \n                                                    data-id=\"{{ $candidate->id }}\" \n                                                    style=\"width: 150px;\">\n                                                <option value=\"interested\" {{ $candidate->status == 'interested' ? 'selected' : '' }}>Interested</option>\n                                                <option value=\"interview_scheduled\" {{ $candidate->status == 'interview_scheduled' ? 'selected' : '' }}>Interview Scheduled</option>\n                                                <option value=\"selected\" {{ $candidate->status == 'selected' ? 'selected' : '' }}>Selected</option>\n                                                <option value=\"rejected\" {{ $candidate->status == 'rejected' ? 'selected' : '' }}>Rejected</option>\n                                            </select>\n                                        </td>\n                                        <td>{{ $candidate->interested_at->format('d M Y, h:i A') }}</td>\n                                        <td>\n                                            <textarea class=\"form-control notes-field\" \n                                                      data-id=\"{{ $candidate->id }}\" \n                                                      rows=\"2\" \n                                                      placeholder=\"Add notes...\">{{ $candidate->notes }}</textarea>\n                                            <button class=\"btn btn-sm btn-success mt-1 save-notes\" \n                                                    data-id=\"{{ $candidate->id }}\">Save Notes</button>\n                                        </td>\n                                        <td>\n                                            @if($candidate->resume)\n                                                <a href=\"{{ route('admin.leads.resume.view', $candidate->resume) }}\" \n                                                   target=\"_blank\" class=\"btn btn-sm btn-info\">View Resume</a>\n                                            @else\n                                                <span class=\"text-muted\">No Resume</span>\n                                            @endif\n                                        </td>\n                                    </tr>\n                                    @endforeach\n                                </tbody>\n                            </table>\n                        </div>\n                        \n                        <!-- Pagination -->\n                        <div class=\"d-flex justify-content-center\">\n                            {{ $candidates->appends(request()->query())->links() }}\n                        </div>\n                    @else\n                        <div class=\"text-center py-4\">\n                            <h5>No interested candidates found</h5>\n                            <p class=\"text-muted\">Candidates marked as \"Interested\" will appear here.</p>\n                        </div>\n                    @endif\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n<script>\n// Update Status\ndocument.querySelectorAll('.status-select').forEach(select => {\n    select.addEventListener('change', function() {\n        const id = this.dataset.id;\n        const status = this.value;\n        \n        fetch(`/admin/interested-candidates/${id}/status`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'X-CSRF-TOKEN': document.querySelector('meta[name=\"csrf-token\"]').content\n            },\n            body: JSON.stringify({ status: status })\n        })\n        .then(response => response.json())\n        .then(data => {\n            if (data.success) {\n                // Show success message\n                const alert = document.createElement('div');\n                alert.className = 'alert alert-success alert-dismissible fade show';\n                alert.innerHTML = `${data.message} <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>`;\n                document.querySelector('.container-fluid').insertBefore(alert, document.querySelector('.row'));\n                \n                setTimeout(() => alert.remove(), 3000);\n            }\n        })\n        .catch(error => console.error('Error:', error));\n    });\n});\n\n// Save Notes\ndocument.querySelectorAll('.save-notes').forEach(button => {\n    button.addEventListener('click', function() {\n        const id = this.dataset.id;\n        const notes = document.querySelector(`.notes-field[data-id=\"${id}\"]`).value;\n        \n        fetch(`/admin/interested-candidates/${id}/notes`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'X-CSRF-TOKEN': document.querySelector('meta[name=\"csrf-token\"]').content\n            },\n            body: JSON.stringify({ notes: notes })\n        })\n        .then(response => response.json())\n        .then(data => {\n            if (data.success) {\n                // Show success message\n                const alert = document.createElement('div');\n                alert.className = 'alert alert-success alert-dismissible fade show';\n                alert.innerHTML = `${data.message} <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>`;\n                document.querySelector('.container-fluid').insertBefore(alert, document.querySelector('.row'));\n                \n                setTimeout(() => alert.remove(), 3000);\n            }\n        })\n        .catch(error => console.error('Error:', error));\n    });\n});\n</script>\n@endsection